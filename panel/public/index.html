<!DOCTYPE html>
<html lang="zh-cn">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>åœ¨çº¿ç™»å…¥</title>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"
        integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script>
    <script type="text/javascript" src="./js/jquery.base64.js"></script>
    <script type="text/javascript" src="./js/skel.min.js"></script>
    <script type="text/javascript" src="./js/main.js"></script>
    <script type="text/javascript"
        src="https://cdn.jsdelivr.net/npm/sweetalert2@10.15.5/dist/sweetalert2.all.min.js"></script>
    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/davidshimjs-qrcodejs@0.0.2/qrcode.min.js"></script>
    <link rel="stylesheet" type="text/css" href="./css/other.css?66886666">
</head>

<body class="landing">
    <div id="page-wrapper">
        <section id="banner">
            <div class="inner">
                <h2>JSTOOL</h2>
                <p>ç‚¹å‡»ä¸‹æ–¹æŒ‰é’®å¼€å§‹ä½¿ç”¨</p>
                <ul class="actions">
                    <li><a id="JumpToApp" class="button special" title="APPç™»å½•">è·³è½¬APPç™»å½•</a>
                    <li><a id="GetQrCode" class="button special" title="æ‰‹æœºæ‰«æäºŒç»´ç ç™»å½•">äºŒç»´ç ç™»å½•</a>
                    <li><a id="login" class="button special" title="APPç™»å½•" href="./login.html">æ§åˆ¶ä¸­å¿ƒ</a>
                    <li><a id="BeanChange" class="button special" title="èµ°åŠ¿å›¾" href="./BeanChange.html">èµ°åŠ¿å›¾</a>
                    </li>
                </ul>
                <p>
                    <!--<a href="http://www.highdimen.com" target="_blank" style="color:yellow;font-weight:bold">[å¤‡ç”¨æ‰«ç ]</a>-->
                    <!--<a href="https://t.me/jstool" target="_blank" style="color:red;font-weight:bold"> [TGç¾¤]</a><br>-->
                    <!--<a style="color:#00effb;font-weight:bold"> [å…¨è‡ªåŠ¨è¿è¡Œ]</a>-->
                    <br /> <a style="font-size:12px;"> Appç¡®è®¤åå³å¯ï¼ˆæ— è§†å‡çº§æç¤ºï¼‰ </a>
                </p>

                <div class="more">
                    <a class="qq_group" id="qq_group" target="_blank" href="https://t.me/jstool">
                        <!--<img border="0" src="static/image/qq.png" alt="è”ç³»å®¢æœ" title="è”ç³»å®¢æœ">-->
                    </a>
                    <br />æ¬¢è¿ğŸ§¡ä½¿ç”¨
                </div>
            </div>
        </section>
    </div>
    <div id="qrcontainer" class="hidden">
        <div class="qframe" id="qframe">
            <div id="refresh_qrcode" class="hidden">
                <div>
                    <h3>äºŒç»´ç å·²å¤±æ•ˆ</h3>
                    <div class="refresh">åˆ·æ–°</div>
                </div>
            </div>
            <div id="qrcode"></div>
            <div class="ps-box">
                <input type="text" id="ps" placeholder="å¯åœ¨æ­¤è¾“å…¥å¤‡æ³¨å">
            </div>
            <div class="info">
                <a style="color:#aaaaaa;">è¯·ä½¿ç”¨äº¬ä¸œAPPæ‰«ç </a>
                <br> <a style="color:#aaaaaa;">æœ‰æ•ˆæœŸä¸ºä¸€ä¸ªæœˆ</a>
                <br>
            </div>
            <div class="qframe-close" title="å…³é—­">âœ–</div>
        </div>
    </div>
</body>

<script>
var qrcode, userCookie, timeId;

$(document).ready(function () {
  qrcode = new QRCode(document.getElementById('qrcode'), {
    text: 'sample',
    correctLevel: QRCode.CorrectLevel.L,
  });

  function checkLogin(user) {
    var timeId = setInterval(() => {
      let timeStamp = new Date().getTime();
      var msg = $('#ps').val();
      console.log(user);
      $.post(`./cookie?t=${timeStamp}`, { user, msg }, function (data) {
        if (data.err == 0) {
          clearInterval(timeId);
          $('#qrcontainer').addClass('hidden');
          $('#refresh_qrcode').addClass('hidden');
          userCookie = data.cookie;
          msg = data.msg;
          Swal.fire({
            title: 'ğŸˆæ·»åŠ æˆåŠŸğŸˆ',
            html:
              '<div class="cookieCon" style="font-size:12px;">' +
              `æ‚¨çš„è´¦å·å·²ç»æˆåŠŸæ·»åŠ ï¼Œæ—¶é•¿ä¸ºä¸€ä¸ªæœˆ` +
              '</div>',
            icon: 'success',
            confirmButtonText: 'è¿”å›',
          }).then((result) => {
            do_landing();
          });
        } else if (data.err == 21) {
          clearInterval(timeId);
          $('#refresh_qrcode').removeClass('hidden');
        }
      });
    }, 3000);
  }

  function GetQrCode() {
    let timeStamp = new Date().getTime();
    $.get('./qrcode?t=' + timeStamp, function (data) {
      if (data.err == 0) {
        $('#qrcontainer').removeClass('hidden');
        $('#refresh_qrcode').addClass('hidden');
        $('.landing').addClass('is-loading');
        qrcode.clear();
        qrcode.makeCode(data.qrcode);
        checkLogin(data.user);
      } else {
        Swal.fire({
          text: data.msg,
          icon: 'error',
        });
      }
    });
  }

  function JumpToApp() {
    let timeStamp = new Date().getTime();
    $.get('./qrcode?t=' + timeStamp, function (data) {
      if (data.err == 0) {
        $('#refresh_qrcode').addClass('hidden');
        window.location.href = `openapp.jdmobile://virtual/ad?params=${encodeURI(
          JSON.stringify({
            category: 'jump',
            des: 'ThirdPartyLogin',
            action: 'to',
            onekeylogin: 'return',
            url: data.qrcode,
            authlogin_returnurl: 'weixin://',
            browserlogin_fromurl: window.location.host,
          })
        )}`;
        checkLogin(data.user);
      } else {
        Swal.fire({
          text: data.msg,
          icon: 'error',
        });
      }
    });
  }

  $('.refresh').click(GetQrCode);
  $('#GetQrCode').click(GetQrCode);
  $('#JumpToApp').click(JumpToApp);

  $('.qframe-close').click(function () {
    qframe_close();
  });

  function do_landing() {
    window.setTimeout(function () {
      $('.landing').removeClass('is-loading');
    }, 100);
  }

  function qframe_close() {
    $("#qrcontainer").addClass("hidden");
    $("#refresh_qrcode").addClass("hidden");
    //window.location.reload();
    clearInterval(timeId);
    do_landing();
  }
});
</script>
</html>